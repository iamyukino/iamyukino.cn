# 本地
# 环境变量C:\iamyukino.cn\apache24（可能MOD_WSGI_APACHE_ROOTDIR）
# 运行pip install mod_wsgi生成.so文件mod_wsgi-express module-config（.pyc后缀改.so）

# 均需要
where python
pip install django
pip install whitenoise
cd C:\iamyukino.cn\apache24\bin
httpd.exe -k install -n 'iamyukino'
httpd.exe -k start -n 'iamyukino'
httpd.exe -k restart -n 'iamyukino'
# net start iamyukino （httpd.exe -k start -n 'iamyukino'）
# net stop iamyukino （httpd.exe -k stop -n 'iamyukino'）
httpd.exe -k uninstall -n 'iamyukino'（httpd.exe -k restart -n 'iamyukino'）

# 测试django
python manage.py runserver

# 修改配置
复制log\文件夹
将Administor修改为iamyu
复制ssl\文件夹

# 字体子集压缩
pip install fonttools
pip install brotli
pyftsubset XiaolaiSC.woff2 --text-file=used.txt --output-file=XiaolaiSC.subset.woff2 --flavor=woff2 --no-hinting --desubroutinize
pyftsubset cjkFonts_allseto_v1.11.ttf --text-file=used.txt --output-file=cjkFonts_allseto_v1.11.subset.woff2 --flavor=woff2 --no-hinting --desubroutinize

# 数据库MySQL
下载https://aka.ms/vs/16/release/vc_redist.x64.exe
pip install mysql
pip install pymysql
# 下载mysql&navicat（windowsserver2012最高支持mysql 8.1.0）
# 运行mysql创建root(PASSWORD_M=)和iamyukino(PASSWORD_D1)账号
# 环境变量path加C:\Program Files\MySQL\MySQL Server 8.1\bin
mysql -u root -p
CREATE DATABASE db_iamyukino CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
GRANT ALL PRIVILEGES ON db_iamyukino.* TO 'iamyukino'@'%';
FLUSH PRIVILEGES;
exit
mysql -u iamyukino -p
# navicat分别连接root和iamyukino

'''# test.py（不应该执行）
from pymysql import Connection
con = None
try:
    # 创建数据库连接
    con = Connection(
        host="localhost",
        port=3306,
        user="iamyukino",
        password="Dong1227",
        database="db_iamyukino"
    )
    # 创建游标对象
    cursor = con.cursor()
    
    #定义建表sql语句
    sql = '''
    CREATE TABLE t_ask (
        id int(11) NOT NULL AUTO_INCREMENT,
        username varchar(32) NOT NULL,
        time DATETIME DEFAULT CURRENT_TIMESTAMP,
        site varchar(128) DEFAULT NULL,
        content text DEFAULT NULL ,
        PRIMARY KEY (id),
        INDEX idx_time (time)
    ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4; 
    '''
    # 选择要操作的数据库
    con.select_db("db_iamyukino")
    # 使用游标对象执行sql
    cursor.execute(sql)

except Exception as e:
    print("exception", e)
finally:
    if con:
        # 关闭连接
        con.close()

'''

cd c:\iamyukino.cn\django
python manage.py startapp mod_iamyukino

'''settings.py
DATABASES = {
    'default': {
        'ENGINE': 'django.db.backends.mysql',
        'NAME': 'db_iamyukino',
        'USER': 'iamyukino',
        'PASSWORD': 'Dong1227',
        'HOST': 'localhost',
        'PORT': '3306',
        'OPTIONS': {
            'init_command': "SET sql_mode='STRICT_TRANS_TABLES'",
            'charset': 'utf8mb4',
        },
    }
}
INSTALLED_APPS = [
    'django.contrib.admin',
    'django.contrib.auth',
    'django.contrib.contenttypes',
    'django.contrib.sessions',
    'django.contrib.messages',
    'django.contrib.staticfiles',
    'mod_iamyukino',  # 你的应用
]
'''

'''mod_iamyukino/__init__.py
import pymysql
pymysql.install_as_MySQLdb()
'''

'''mod_iamyukino/models.py
from django.db import models

class Ask(models.Model):
    username = models.CharField(max_length=32)
    time = models.DateTimeField(auto_now_add=True)
    site = models.CharField(max_length=128, null=True, blank=True)
    content = models.TextField(null=True, blank=True)

    class Meta:
        indexes = [
            models.Index(fields=['time'], name='idx_time')
        ]

    def __str__(self):
        ret = {
            "username" : self.username,
            "time" : str(self.time),
            "site" : self.site,
            "content" : self.content
        }
        return str(ret)

'''

python manage.py makemigrations mod_iamyukino
python manage.py migrate

'''mod_iamyukino/tests.py
from mod_iamyukino.models import Ask
def Test():
    # 创建测试数据
    Ask.objects.create(username="testuser", site="example.com", content="Hello World")
    # 查询数据
    return Ask.objects.all()
'''

'''urls.py
    path('db_ask', views.db_ask),
'''

'''db_ask.html
{{content}}
'''






















